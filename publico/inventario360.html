<!DOCTYPE html>
<html lang="es">
<head><!--encabezado de la pagina-->
    <meta charset="UTF-8"><!--tipo de codificacion-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"><!--para que se adapte a cualquier pantalla-->
    <title>Inventario360</title><!--titulo de la pagina-->
    <link rel="stylesheet" href="stilos/appstyles.css"><!--enlace a la hoja de estilos-->
    <!-- Chart.js para gr치ficas de estad칤sticas -->
    <!-- Usar una versi칩n fija evita solicitudes a mapas de origen que pueden no existir en la URL gen칠rica -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js" defer></script>
    <!--esto permite restringir la entrada sin antes loguiase-->
    <!--<script>
        window.onload = function() {  
            const usuario = localStorage.getItem("usuarioActivo");
            if (!usuario) {
            window.location.href = "login.html"; // redirige si no hay sesi칩n
            }
        };
    </script>
    <script>
        const usuario = localStorage.getItem("usuarioActivo");
        if (!usuario) {
            window.location.href = "login.html";
        }
    </script>-->
</head>

<body>
    <div class="contenedor-app">
    <!-- dashboar para ociones fijas -->
        <aside class="sidebar">
            <div style="display: flex; align-items: center;">
                <img src="assets/logoinventario360.png" alt="Logo" style="height: 40px; margin-right: 10px;">
                <span style="font-size: 17px; font-weight: bold;">Inventario 360</span>
            </div>
            <nav>
                <ul>
                    <li class="nav-item perfil-nav" onclick="mostrarModulo('Perfil')">
                        <img id="topbarFoto" src="assets/logoinventario360.png" alt="Foto perfil" />
                        <div class="perfil-nav-text">
                            <span class="perfil-nav-label">Perfil</span>
                            <strong id="topbarNombre">Usuario</strong>
                        </div>
                    </li>
                    <label for="menu">Menu</label>
                    <li onclick="mostrarModulo('inventario')">Inventario</li>
                    <li onclick="mostrarModulo('ventas')">Ventas</li>
                    <li onclick="mostrarModulo('Movimientos')">Movimientos</li>
                    <li onclick="mostrarModulo('Estad칤sticas')">Estad칤sticas</li>
                    <label for="Contactos">Contactos</label>
                    <li onclick="mostrarModulo('clientes')">Clientes</li>
                    <li onclick="mostrarModulo('proveedores')">Proveedores</li>
                    <li onclick="mostrarModulo('ajustes')">Ajustes</li>
                    <button onclick="cerrarSesion('Cerrar sesion')">Cerrar sesi칩n</button>
                </ul>
            </nav>
        </aside>
        <!-- 츼rea din치mica -->
        <main class="contenido">
            <!-- Barra superior con perfil compacto -->
            <div class="topbar">
                <div class="topbar-left"></div>
                <div class="topbar-right"></div>
            </div>
            <!--aqui comiensa el perfil de usuario se traen datos de la base y se permiten agregar datos adicionales-->
            <section id="Perfil" class="modulo">
                <h2>Perfil de usuario</h2>
                <div class="perfil-info">
                    <!-- Cambiado a input file: permite seleccionar una imagen desde el equipo -->
                    <input type="file" id="fotoperfil" accept="image/*" />
                    <!-- Vista previa de la foto seleccionada -->
                    <img id="previewFoto" alt="Foto de perfil" style="display:block; max-width:120px; margin-top:8px;" />
                    <label>Nombre:</label>
                    <input type="text" id="nombreUsuario" placeholder="Tu nombre">
                    <label>Direcci칩n:</label>
                    <input type="text" id="direccionUsuario" placeholder="Calle, n칰mero, barrio">
                    <label>Ciudad:</label>
                    <input type="text" id="ciudadUsuario" placeholder="Ciudad">
                    <label>Pa칤s:</label>
                    <input type="text" id="paisUsuario" placeholder="Pa칤s">
                    <label>C칩digo postal:</label>
                    <input type="text" id="codigoPostalUsuario" placeholder="00000">
                    <label>Detalles / Notas:</label>
                    <textarea id="detallesUsuario" placeholder="Notas adicionales sobre el usuario" rows="3"></textarea>
                    <label>Correo:</label>
                    <input type="email" id="correoUsuario" placeholder="tu@email.com">
                    <label>Tel칠fono:</label>
                    <input type="tel" id="telefonoUsuario" placeholder="8888-8888">
                    <button onclick="guardarPerfil()">Guardar cambios</button>
                </div>
            </section>
            <!--aqui comiensa el inventario-->
            <section id="inventario" class="modulo activo">
                <div class="section-card inventario-card">
                    <div class="inventario-top">
                        <div>
                            <p class="section-tag">Control general</p>
                            <h2>Inventario</h2>
                        </div>
                        <div class="inventario-metrics">
                            <div class="metric-card">
                                <span>Total productos</span>
                                <strong id="totalArticulos">0</strong>
                            </div>
                            <div class="metric-card">
                                <span>Costo inventario</span>
                                <strong id="costoInventario">C$0.00</strong>
                            </div>
                        </div>
                        <div class="inventario-actions">
                            <button id="btnCrearCategoria" class="btn-action ghost" onclick="crearCategorias()">Crear Categor칤a</button>
                            <button id="btnCrearProducto" class="btn-action primary" onclick="crearProducto()">Crear Producto</button>
                        </div>
                    </div>

                    <div class="inventario-controls">
                        <div class="search-box">
                            <span class="search-icon">游댌</span>
                            <input type="text" id="buscador" placeholder="Buscar por nombre, c칩digo o ID" />
                        </div>
                    </div>

                    <div id="categoriasHeader" class="categorias-header"></div>

                    <div class="tabla-wrapper inventario-tabla-wrapper">
                        <table class="tabla-inventario">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Producto</th>
                                    <th>칔ltima actualizaci칩n</th>
                                    <th>Cantidad</th>
                                    <th>Precio</th>
                                    <th>Estimado</th>
                                    <th>Costo</th>
                                    <th>Ganancia</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="tablaInventarioBody">
                                <!-- Filas din치micas -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
            <!-- Modal gen칠rico -->
            <div id="modal" class="modal">
                <div class="modal-contenido modal-content">
                        <button type="button" class="cerrar" aria-label="Cerrar modal" onclick="cerrarModal()">&times;</button>
                        <h3 id="modal-titulo"></h3>
                        <form id="modal-form"></form>
                    </div>
            </div>
            <!--aqui comiensa el apartado de ventras-->
            <section id="ventas" class="modulo">
                <h2>Ventas</h2>
                <!-- Formulario o historial de ventas -->
                <div class="ventas-header">
                    <div class="ventas-inventario">
                        <h3>Buscar producto</h3>
                        <input type="text" id="buscadorVentas" placeholder="Buscar por nombre, c칩digo o ID (Ventas)" />
                        <ul id="resultados"></ul>
                        <table class="ventas-inventario">
                            <thead>
                                <tr>
                                <th>Imagen</th>
                                <th>Producto</th>
                                <th>Disponible</th>
                                <th>Precio</th>
                                </tr>
                            </thead>
                            <tbody id="tablaventasBody"></tbody><!--filas dinamicas-->
                        </table>
                    </div>
                    <div class="ventas-canasta">
                        <h3>Canasta de venta</h3>
                        <div class="ventas-cliente-select">
                            <label for="clienteVentaSelect">Cliente (opcional)</label>
                            <select id="clienteVentaSelect">
                                <option value="">Sin cliente</option>
                            </select>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>Producto</th>
                                    <th>Cantidad</th>
                                    <th>Precio</th>
                                    <th>Subtotal</th>
                                    <th>Eliminar</th>
                                </tr>
                            </thead>
                            <tbody id="canastaBody"></tbody>
                        </table>
                        <div class="ventas-acciones">
                            <button onclick="Nuevaventa()">Nueva venta</button>
                            <button onclick="vaciarcanasta()">Vaciar canasta</button>
                            <button onclick="terminarventa()">Terminar venta</button>
                            <button onclick="abrirModalGasto()">Registrar gasto</button>
                        </div>
                    </div>
                </div>                
            </section>
            <!--Aqui comiensa el apartado de movimientos-->
            <section id="Movimientos" class="modulo">
                <h2>Movimientos</h2>
                <div class="Movimientos-header">
                    <label for="fechaBaseMovimientos">Selecciona una fecha base:</label>
                    <input type="date" id="fechaBaseMovimientos">
                    <label for="rangoTiempoMovimientos">Rango:</label>
                    <select id="rangoTiempoMovimientos">
                        <option value="dia">D칤a</option>
                        <option value="semana">Semana</option>
                        <option value="mes">Mes</option>
                        <option value="a침o">A침o</option>
                    </select>
                        <button onclick="filtrarPorRango()">Buscar</button>
                        <label for="filterTipo">Tipo:</label>
                        <select id="filterTipo" aria-label="Filtrar por tipo">
                            <option value="">Todos</option>
                            <option value="venta">Venta</option>
                            <option value="egreso">Egreso</option>
                            <option value="ajuste">Ajuste</option>
                            <option value="gasto">Gasto</option>
                        </select>
                        <label for="filterProducto">Producto:</label>
                        <select id="filterProducto" aria-label="Filtrar por producto"><option value="">Todos</option></select>
                        <button onclick="loadMovimientosUI()">Refrescar</button>
                        <button onclick="exportMovimientosCSV()">Exportar CSV</button>
                </div>
                <div class="movimientos-controles">
                    <button onclick="mostrarMovimientos('ingresos')">Ingresos</button>
                    <button onclick="mostrarMovimientos('egresos')">Egresos</button>
                    <button onclick="mostrarMovimientos('porPagar')">Por pagar</button>
                    <button onclick="mostrarMovimientos('porCobrar')">Por cobrar</button>
                </div>
                <div class="movimientos-tabla">
                    <table>
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Tipo</th>
                                <th>Detalles</th>
                                <th>Cantidad</th>
                                <th>Monto</th>
                                <th>Vinculado</th>
                            </tr>
                        </thead>
                        <tbody id="tablaMovimientosBody">
                        <!-- Filas din치micas -->
                        </tbody>
                    </table>
                </div>
                <!-- Formulario para agregar productos -->
            </section>
            <!--aqui comiensa mi apartado de estadisticas-->
            <section id="Estad칤sticas" class="modulo">
                <div class="section-card stats-card">
                    <div class="stats-header">
                        <div>
                            <p class="section-tag">Resumen</p>
                            <h2>Estad칤sticas</h2>
                        </div>
                        <div class="stats-filters">
                            <label>Fecha base</label>
                            <input type="date" id="fechaBaseEstadisticas">
                            <label for="rangoTiempoEstadisticas">Rango</label>
                            <select id="rangoTiempoEstadisticas">
                                <option value="dia">D칤a</option>
                                <option value="semana">Semana</option>
                                <option value="mes">Mes</option>
                                <option value="a침o">A침o</option>
                            </select>
                            <button class="btn-action" onclick="filtrarEstadisticas()">Buscar</button>
                        </div>
                    </div>

                    <div class="stats-metrics">
                        <div class="metric-card">
                            <span>Total vendido</span>
                            <strong>C$<span id="totalVentas">0</span></strong>
                            <small>monto vendido seg칰n el rango</small>
                        </div>
                        <div class="metric-card">
                            <span>Ganancia estimada</span>
                            <strong>C$<span id="gananciaTotal">0</span></strong>
                            <small>utilidad despu칠s de costos</small>
                        </div>
                        <div class="metric-card">
                            <span>Costo total</span>
                            <strong>C$<span id="costoTotal">0</span></strong>
                            <small>inversi칩n del stock vendido</small>
                        </div>
                        <div class="metric-card">
                            <span>Productos vendidos</span>
                            <strong><span id="productosVendidos">0</span></strong>
                            <small>unidades totales</small>
                        </div>
                    </div>

                    <div class="stats-layout">
                        <div class="chart-card stats-chart stats-chart--bar">
                            <div class="chart-title">Detalles de ventas</div>
                            <canvas id="salesBarChart"></canvas>
                        </div>
                        <div class="chart-card stats-chart stats-chart--pie">
                            <div class="chart-title">Distribuci칩n por producto</div>
                            <canvas id="salesPieChart"></canvas>
                        </div>
                        <div class="stats-table stats-table--wide">
                            <div class="chart-title">Detalles de productos vendidos</div>
                            <div class="tabla-wrapper">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Periodo</th>
                                            <th>Producto</th>
                                            <th>Cantidad</th>
                                            <th>Precio</th>
                                            <th>Costo</th>
                                            <th>Ganancia</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tablaEstadisticasBody"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            <!--Aqui comiensa el apartado para los clientes del usuario-->
            <section id="clientes" class="modulo">
                <h2>Clientes</h2>
                <div class="resumen-grid">
                    <div class="resumen-card">
                        <span class="resumen-label">Clientes registrados</span>
                        <strong class="resumen-value" id="totalClientesResumen">0</strong>
                    </div>
                    <div class="resumen-card">
                        <span class="resumen-label">Total por cobrar</span>
                        <strong class="resumen-value" id="totalPorCobrarResumen">C$0.00</strong>
                    </div>
                </div>
                <input type="text" id="nuevoCliente" placeholder="Nombre del cliente">
                <button onclick="agregarCliente()">Agregar r치pido</button>
                <button type="button" class="btn-action" onclick="crearCliente()">Formulario completo</button>
                <div id="listaClientes" class="tabla-wrapper"></div>
            </section>
            <!--Aqui comiensa el apartado para los proveedores del usario-->
            <section id="proveedores" class="modulo">
                <h2>Proveedores</h2>
                <div class="resumen-grid">
                    <div class="resumen-card">
                        <span class="resumen-label">Proveedores registrados</span>
                        <strong class="resumen-value" id="totalProveedoresResumen">0</strong>
                    </div>
                    <div class="resumen-card">
                        <span class="resumen-label">Total a pagar</span>
                        <strong class="resumen-value" id="totalPorPagarResumen">C$0.00</strong>
                    </div>
                </div>
                <input type="text" id="nuevoProveedor" placeholder="Nombre del proveedor">
                <button onclick="agregarProveedor()">Agregar r치pido</button>
                <button type="button" class="btn-action" onclick="crearProveedor()">Formulario completo</button>
                <div id="listaProveedores" class="tabla-wrapper"></div>
            </section>
            <!--Aqui podemos hacer algunos cambios en la app-->
            <section id="ajustes" class="modulo">
                <h2>Ajustes del sistema</h2>
                <div class="ajustes-grupo">
                    <label for="nombreEmpresa">Nombre de la empresa:</label>
                    <input type="text" id="nombreEmpresa" placeholder="Inventario 360">
                </div>
                <div class="ajustes-grupo">
                    <label for="moneda">Moneda:</label>
                    <select id="moneda">
                        <option value="C$">C$ C칩rdoba</option>
                        <option value="$">$ D칩lar</option>
                    </select>
                </div>
                <div class="ajustes-grupo">
                    <label>Notificaciones:</label>
                    <input type="checkbox" id="notificaciones"> Activar alertas
                </div>
                <div class="ajustes-grupo">
                    <button onclick="guardarAjustes()">Guardar ajustes</button>
                    <button onclick="exportarDatos()">Exportar datos</button>
                    <button onclick="confirmarReset()">Restablecer sistema</button>
                </div>
            </section>
        </main>
    </div>
    <script type="module" src="./js/index.js"></script>
</body>
</html>